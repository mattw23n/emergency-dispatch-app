# Frontend CI/CD Pipeline
# Purpose: Validate and test frontend code quality
# Note: Frontend is served by api-gateway, not deployed separately
# This pipeline ensures code quality before merging to main branch

stages:
  - Static Analysis
  - Security Testing
  - Test

html-validate:
  stage: Static Analysis
  image: node:18-alpine
  before_script:
    - npm install -g html-validate
  script:
    - html-validate *.html | tee html_validate_report.txt || echo "HTML validation warnings found"
  artifacts:
    when: always
    paths:
      - html_validate_report.txt
  allow_failure: true

eslint:
  stage: Static Analysis
  image: node:18-alpine
  before_script:
    - npm install -g eslint
  script:
    - eslint --no-eslintrc --env browser,es6 --parser-options ecmaVersion:2020 dashboard.html index.html || echo "ESLint warnings found"
  allow_failure: true

semgrep:
  stage: Security Testing
  image: returntocorp/semgrep
  script: ["semgrep ci --config p/owasp-top-ten"]
  allow_failure: true

trivy:
  stage: Security Testing
  image:
    name: aquasec/trivy:latest
    entrypoint: [""]
  script: ["trivy fs --severity CRITICAL,HIGH ."]

gitleaks:
  stage: Security Testing
  image:
    name: zricethezav/gitleaks:latest
    entrypoint: [""]
  script: ["gitleaks detect --source . --no-git -v"]

integration-tests:
  stage: Test
  image: docker:28.3.2
  services:
    - docker:28.3.2-dind
  before_script:
    - docker info
  script:
    - docker compose -f ci/compose.test.yaml up --exit-code-from frontend-test
